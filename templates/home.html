{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BoardingEase</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/home_cards.css' %}">
    <link rel="stylesheet" href="{% static 'css/sb-admin-2.min.css' %}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<!-- üîù Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
    <div class="container">
        <a class="navbar-brand fw-bold" href="#">üè† BoardingEase</a>
    </div>
</nav>

<!-- üì¢ Flash Messages -->
{% if messages %}
<div class="container mt-3">
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}
</div>
{% endif %}

<div class="container mt-5">
    <!-- üè† Hero Section -->
    <div class="text-center mb-4">
        <h1 class="fw-bold">Welcome to BoardingEase</h1>
        <p class="text-muted">Find your ideal boarding house in Pagadian City</p>
    </div>

    <!-- üîç Advanced Search Filters -->
        <form method="get" class="mb-5 mx-auto p-4 border rounded shadow-sm" style="max-width: 900px; background-color: #f9f9f9;">
            <h5 class="fw-bold mb-3">Filter Boarding Houses</h5>

            <div class="row g-3">

                <!-- Address Search -->
                <div class="col-md-6">
                    <input 
                        type="text" 
                        name="q" 
                        class="form-control" 
                        placeholder="Search by address..." 
                        value="{{ query|default:'' }}"
                    >
                </div>

                <!-- Room Type (Bedspacer) -->
                <div class="col-md-6">
                    <select name="bedspacer" class="form-select">
                        <option value="">Room Type</option>
                        <option value="yes" {% if bedspacer == 'yes' %}selected{% endif %}>Bed Spacer</option>
                        <option value="no" {% if bedspacer == 'no' %}selected{% endif %}>Regular Room</option>
                    </select>
                </div>
            </div>

            <!-- Collapsible Optional Filters -->
            <div class="mt-3">
                <a class="btn btn-outline-secondary btn-sm" data-bs-toggle="collapse" href="#optionalFilters" role="button" aria-expanded="false" aria-controls="optionalFilters">
                    Optional Filters
                </a>

                <div class="collapse mt-3" id="optionalFilters">
                    <div class="row g-3">

                        <!-- Amenities -->
                        <div class="col-md-4">
                            <select name="amenities" class="form-select">
                                <option value="">Amenity</option>
                                {% for key, label in amenities_choices %}
                                    <option value="{{ key }}" {% if key == selected_amenities %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Inclusions -->
                        <div class="col-md-4">
                            <select name="inclusions" class="form-select">
                                <option value="">Inclusion</option>
                                {% for key, label in inclusion_choices %}
                                    <option value="{{ key }}" {% if key == selected_inclusions %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- House Rules -->
                        <div class="col-md-4">
                            <select name="house_rules" class="form-select">
                                <option value="">House Rule</option>
                                {% for key, label in house_rule_choices %}
                                    <option value="{{ key }}" {% if key == selected_house_rules %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>

                    </div>
                </div>
            </div>

            <div class="mt-3 text-end">
                <button class="btn btn-primary" type="submit">
                    <i class="fas fa-search"></i> Search
                </button>
            </div>
        </form>

        

    <!-- üèòÔ∏è Boarding Houses Section -->
    <div class="container mt-5">
        <h2 class="fw-bold mb-4">Available Boarding Houses</h2>
    
        {% if boardinghouses %}
        <div class="row g-4">
            {% for bh in boardinghouses %}
                {% if bh.capacity|default:0 > bh.current_bookings|default:0 %}
                <div class="col-md-6 col-lg-4">
                    <div class="card bh-card h-100">

                        <!-- üì∑ Image & Badge -->
                        <div class="bh-img-container">
                            {% if bh.image %}
                                <img src="{{ bh.image.url }}" alt="{{ bh.name }}" class="bh-img">
                            {% else %}
                                <img src="https://via.placeholder.com/300x200?text=No+Image" class="bh-img" alt="No Image">
                            {% endif %}

                            <span class="bh-badge bg-success text-white">Room Available</span>
                        </div>

                        <!-- üìÑ Details -->
                        <div class="card-body">
                            <h5 class="card-title text-primary mb-1">{{ bh.name }}</h5>
                            <p class="small text-muted truncate-text mb-2">
                                <i class="fas fa-map-marker-alt me-1"></i> {{ bh.address }}
                            </p>

                            <!-- üõèÔ∏è Room Details -->
                            <ul class="list-group list-group-flush small mb-3">
                                <li class="list-group-item">
                                    {% if bh.is_bedspacer %}
                                        <span class="badge bg-info text-dark">Bed Spacer</span><br>
                                        Occupied: {{ bh.current_bookings }}/{{ bh.capacity }} 
                                        ({{ bh.capacity|add:"-bh.current_bookings" }} left)
                                    {% else %}
                                        <span class="badge bg-secondary">Regular Room</span><br>
                                        <span class="text-success">Available</span>
                                    {% endif %}
                                </li>
                            </ul>

                            <!-- ‚ö° Actions -->
                            <div class="d-flex gap-2">
                                <a href="{% url 'boardinghouse_detail' bh.pk %}" 
                                   class="btn btn-outline-primary btn-sm w-100">
                                    View
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        </div>
        {% else %}
            <div class="alert alert-info text-center mt-4">
                No boarding houses available at the moment.
            </div>
        {% endif %}
    </div>
</div>  

<!-- üì¶ Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
