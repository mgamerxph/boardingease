{% load static %}
{% load custom_tags %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ bh.name }} - Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/detail.css' %}">
</head>
<body>

<!-- üîù Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
    <div class="container">
        <a class="navbar-brand fw-bold" href="#">üè† BoardingEase</a>
        <div class="ms-auto">
            <a class="btn btn-outline-dark" href="{% url 'home' %}">‚Üê Back to Home</a>
        </div>
    </div>
</nav>

{% if messages %}
  <div class="container mt-3">
    {% for message in messages %}
      {% if 'booking' in message.tags %}
        <div class="alert alert-{{ message.tags|cut:'booking' }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endif %}
    {% endfor %}
  </div>
{% endif %}

<div class="container mt-5">
    <div class="card detail-card shadow p-4">
        <!-- üè† Title -->
        <h2 class="text-center mb-4">{{ bh.name }}</h2>

        <!-- üì∑ Image -->
        {% if bh.image %}
        <div class="text-center mb-4">
            <img src="{{ bh.image.url }}" class="img-fluid rounded" alt="Boarding House Image">
        </div>
        {% endif %}

        <!-- üìç Address -->
        <div class="mb-3">
            <h5 class="text-muted">üìç Address:</h5>
            <p>{{ bh.address }}</p>
        </div>

        <!-- üí∞ Price -->
        <div class="mb-3">
            <h5 class="text-muted">üí∞ Price:</h5>
            <p class="fs-5 fw-semibold text-success">‚Ç±{{ bh.price }} / Month</p>
        </div>

        <!-- üë§ Owner -->
        <div class="mb-3">
            <h5 class="text-muted">üë§ Owner:</h5>
            {% if bh.owner.profile %}
                <p>
                    {{ bh.owner.profile.first_name }} {{ bh.owner.profile.last_name }} <br>
                    üìû {{ bh.owner.profile.contact_number }} <br>
                    ‚úâÔ∏è {{ bh.owner.profile.email }}
                </p>
            {% else %}
                <p>{{ bh.owner.username }}</p>
            {% endif %}
        </div>

        <!-- üìñ Rules, üì¶ Inclusions, üè¢ Amenities -->
        <div class="row">
            <!-- Rules -->
            <div class="col-md-4 mb-4">
                <div class="card p-3">
                    <h5>üìñ House Rules:</h5>
                    <ul class="list-group list-group-flush">
                        {% for rule in bh.house_rules %}
                        <li class="list-group-item">
                            {% if rule == 'curfew' %}
                                Curfew: 
                                {% if bh.curfew_start and bh.curfew_end %}
                                    {{ bh.curfew_start|time:"h:i A" }} ‚Äì {{ bh.curfew_end|time:"h:i A" }}
                                {% else %}
                                    No time specified
                                {% endif %}
                            {% elif rule == 'advance_payment' %}
                                Advance Payment: {{ bh.advance_months }} Month(s)
                                <span class="badge bg-warning text-dark">Required</span>
                            {% elif rule == 'deposit' %}
                                Deposit: {{ bh.deposit_months }} Month(s)
                                <span class="badge bg-info text-dark">Required</span>
                            {% else %}
                                {{ rule|title }}
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% if bh.other_house_rules %}
                    <p class="mt-2"><strong>Other:</strong> {{ bh.other_house_rules }}</p>
                {% endif %}
            </div>

            <!-- Inclusions -->
            <div class="col-md-4 mb-4">
                <h5 class="text-muted">üì¶ Inclusions:</h5>
                {% if bh.get_inclusions_display %}
                    <ul class="list-group">
                        {% for inc in bh.get_inclusions_display|split:"," %}
                            <li class="list-group-item">{{ inc }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>No inclusions listed.</p>
                {% endif %}
                {% if bh.other_inclusions %}
                    <p class="mt-2"><strong>Other:</strong> {{ bh.other_inclusions }}</p>
                {% endif %}
            </div>

            <!-- Amenities -->
            <div class="col-md-4 mb-4">
                <h5 class="text-muted">üè¢ Amenities:</h5>
                {% if bh.get_amenities_display %}
                    <ul class="list-group">
                        {% for amenity in bh.get_amenities_display|split:"," %}
                            <li class="list-group-item">{{ amenity }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>No amenities listed.</p>
                {% endif %}
                {% if bh.other_amenities %}
                    <p class="mt-2"><strong>Other:</strong> {{ bh.other_amenities }}</p>
                {% endif %}
            </div>
        </div>

        <!-- üõèÔ∏è Room Details -->
        <div class="mt-4">
            <h4 class="text-muted">üõèÔ∏è Room Details</h4>
            <div class="card p-3">
                <h5>{{ bh.name }}</h5>
                <p>
                    Type: 
                    <span class="badge bg-secondary">{% if bh.is_bedspacer %}Bed Spacer{% else %}Regular{% endif %}</span><br>
                    Capacity: {{ bh.capacity }}<br>
                    Occupants: {{ bh.current_bookings }}<br>
                    Available: <span class="fw-bold text-success">{{ bh.available_slots }}</span>
                </p>
                {% if bh.available_slots > 0 %}
                    <a href="{% url 'book_boardinghouse' bh.pk %}" class="btn btn-dark w-100">Book This Room</a>
                {% else %}
                    <div class="alert alert-danger text-center p-1 mt-2 mb-0">Fully Occupied</div>
                {% endif %}
            </div>
        </div>

        <!-- üì¢ Booking Status -->
        {% if booking_status == 'approved' %}
            <div class="alert alert-success text-center fw-semibold mt-4">
                ‚úÖ Your booking has been approved.
            </div>
        {% elif booking_status == 'pending' %}
            <div class="alert alert-warning text-center fw-semibold mt-4">
                ‚è≥ Your booking is pending. Please wait for approval.
            </div>
        {% elif bh.is_booked %}
            <div class="alert alert-danger text-center fw-semibold mt-4">
                ‚ùå This boarding house is already <strong>fully booked</strong>.
            </div>
        {% endif %}
    </div>
</div>

<!-- üì¶ Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
